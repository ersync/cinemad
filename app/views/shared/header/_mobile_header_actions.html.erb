<div class="flex justify-center items-center gap-x-4">
  <button
    onclick="window.dispatchEvent(new CustomEvent('toggleGlobalSearch'))"
    class="flex items-center justify-center rounded-full hover:bg-white/10 active:bg-white/20 transition-colors">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
  </button>

  <% if user_signed_in? %>
    <div class="relative">
      <button onclick="toggleProfileMenu(event)" class="relative flex items-center">
        <% if current_user.avatar.attached? %>
          <img
            src="<%= url_for(current_user.avatar) %>"
            alt="<%= current_user.username %>"
            class="w-8 h-8 rounded-full object-cover shadow-lg ring-2 ring-white/10 hover:ring-white/20 transition-all duration-200"
          >
        <% else %>
          <%= render "shared/header/avatar_placeholder", username: current_user.username, classes: "w-7 h-7" %>
        <% end %>
        <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 rounded-full border-2 border-[#032541]"></div>
      </button>
    </div>
  <% else %>
    <a href="<%= new_user_session_path %>"
       class="px-4 py-1.5 rounded-full bg-white/10 text-sm font-medium hover:bg-white/20 active:bg-white/30 transition-all duration-200 flex items-center gap-2">
      Login
    </a>
  <% end %>

  <button
    id="menu-button"
    class="relative w-7 h-7 flex items-center justify-center group"
  >
    <div class="flex flex-col gap-1 w-6">
      <span class="w-5 h-0.5 bg-white origin-center transition-all duration-300
                 group-[.open]:rotate-45 group-[.open]:translate-y-[6px]"></span>

      <span class="w-5 h-0.5 bg-white transition-all duration-300
                 group-[.open]:opacity-0"></span>

      <span class="w-5 h-0.5 bg-white origin-center transition-all duration-300
                 group-[.open]:-rotate-45 group-[.open]:-translate-y-[6px]"></span>
    </div>
  </button>
</div>

<% if user_signed_in? %>
  <div id="mobile-profile-menu"
       class="fixed inset-x-0 bottom-0 transform translate-y-full transition-transform duration-300 ease-out z-[75]">
    <div class="bg-gradient-to-b from-[#032541] via-[#034275] to-[#032541] rounded-t-2xl shadow-2xl max-h-[85vh] overflow-y-auto">
      <div class="p-6 text-center border-b border-white/10">
        <div class="inline-block relative mb-3">
          <% if current_user.avatar.attached? %>
            <img
              src="<%= url_for(current_user.avatar) %>"
              alt="<%= current_user.username %>"
              class="w-20 h-20 rounded-full object-cover shadow-xl ring-4 ring-white/10"
            >
          <% else %>
            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-[#034275] to-[#032541] flex items-center justify-center text-white text-2xl font-semibold shadow-xl ring-4 ring-white/10">
              <%= current_user.username[0].upcase %>
            </div>
          <% end %>
          <div class="absolute bottom-0 right-0 w-5 h-5 bg-emerald-500 rounded-full border-4 border-[#032541]"></div>
        </div>
        <h2 class="text-white text-xl font-semibold mb-1"><%= current_user.username %></h2>
        <p class="text-white/60 text-sm"><%= current_user.email %></p>
      </div>

      <div class="p-4 space-y-1">
        <a href="/users/<%= current_user.username %>" class="flex items-center gap-3 px-4 py-3 rounded-xl text-white hover:bg-white/10 active:bg-white/15 transition-colors">
          <svg class="w-5 h-5 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          View Profile
        </a>

        <a href="/users/<%= current_user.username %>/watchlist" class="flex items-center gap-3 px-4 py-3 rounded-xl text-white hover:bg-white/10 active:bg-white/15 transition-colors">
          <svg class="w-5 h-5 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
          </svg>
          Watchlist
        </a>

        <a href="/users/<%= current_user.username %>/edit" class="flex items-center gap-3 px-4 py-3 rounded-xl text-white hover:bg-white/10 active:bg-white/15 transition-colors">
          <svg class="w-5 h-5 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
          </svg>
          Edit Profile
        </a>

        <%= button_to destroy_user_session_path,
          method: :delete,
          class: "w-full flex items-center gap-3 px-4 py-3 rounded-xl text-red-400 hover:bg-red-500/10 active:bg-red-500/15 transition-colors" do %>
          <svg class="w-5 h-5 text-red-400/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          Logout
        <% end %>
      </div>
    </div>
  </div>

  <div id="profile-menu-overlay"
       class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 z-[70]"
       >
  </div>
<% end %>
